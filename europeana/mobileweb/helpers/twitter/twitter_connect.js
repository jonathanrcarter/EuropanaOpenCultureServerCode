var css=require("/ui/common/css");
function twitter_connect(){var b=Titanium.UI.createWindow({title:"Twitter",barColor:css.BARCOLOUR,backgroundGradient:css.WINGRAD2}),a=Ti.UI.createView({width:"100%",height:"100%",backgroundColor:"transparent"}),c=Ti.UI.createView({top:0,height:"0%",width:"100%"}),g=Ti.UI.createView({top:"0%",height:"100%",width:"100%"}),d=Ti.UI.createView({bottom:0,height:"0%",width:"100%"});Ti.UI.createScrollView({contentWidth:"auto",contentHeight:"auto"});a.add(c);a.add(g);a.add(d);b.add(a);require("/ui/common/config");
var f=new (require("/helpers/twitter/twitter")),a=Titanium.UI.createView({layout:"vertical"}),e=Ti.UI.createButton({left:20,right:20,height:50});css.addButBackground(e);e.addEventListener("click",function(a){"logout"==a.source.x_action?(a.source.title="connect",a.source.x_action="connect",a=f.runQuery("logout"),j(a)):(a.source.title="logout",a.source.x_action="logout",f.runQuery("connect"))});c=Titanium.UI.createView({height:100,left:20,right:20});d=require("helpers/twitter/twitter_state");d.load();
var k="",k=!0==d.loggedin()?"logged in as @"+d.username():"Not connected to Twitter",h=Ti.UI.createLabel({text:k,color:"#fff"});c.add(h);a.add(c);a.add(e);g.add(a);var j=function(a){if(a&&null!=a&&!0==a.loggedin){h.text="logged in as @"+a.username;e.title="logout";e.x_action="logout";var b=require("/helpers/twitter/twitter_state");b.load();b.set(a.username,a.username,!0,!0)}else h.text="Not connected to Twitter",e.title="Connect",e.x_action="connect",b=require("/helpers/twitter/twitter_state"),b.load(),
b.set("","",!1,!1);b.save()},i=function(){var a=f.runQuery("me");j(a)};b.addEventListener("open",function(){Titanium.App.addEventListener("twitter_state_change",i);i()});b.addEventListener("close",function(){Titanium.App.removeEventListener("twitter_state_change",i)});return b}module.exports=twitter_connect;
module.exports.post=function(){var b=require("/ui/common/config");Titanium.Facebook.appid=b.Facebook.appid;Titanium.Facebook.permissions=b.Facebook.permissions;Ti.Facebook.permissions=["create_event"];Ti.Facebook.authorize();b=new Date(2012,4,31,19,0);b={start_time:JSON.stringify(new Date(2012,4,31,17,0)),end_time:JSON.stringify(b),summary:"Barry will have a great party",name:"Barry's Birthday Celebration"};Ti.Facebook.requestWithGraphPath("me/events",b,"POST",function(a){a.success?alert("Success! Returned from FB: "+
a.result):a.error?alert(a.error):alert("Unknown result")})};
module.exports.postdialog=function(b,a){a||(a="http://www.vistory.nl/clip.shtml?movie=oai:openimages.eu:20424");b||(b="Check out this movie on @Vistory_app ");var c=Ti.UI.createWindow({title:"Share on Twitter"});css.addWinBackground(c);var g=Ti.UI.createView({layout:"horizontal"}),d=Ti.UI.createTextArea({left:0,right:0,bottom:0,top:0,backgroundColor:"#fff",font:{fontSize:16},value:b});d.addEventListener("change",function(a){120<a.value.length&&(d.value=a.value.substr(0,120))});var f=Ti.UI.createButton({left:"10%",
right:"10%",top:8,bottom:8,title:"post"}),e=Ti.UI.createButton({title:"cancel"});f.addEventListener("click",function(){var b=d.value+" "+a;d.blur();require("/ui/common/config");(new (require("/helpers/twitter/twitter"))).runQuery("post",b);c.close()});e.addEventListener("click",function(){c.close()});g.add(d);c.add(g);c.leftNavButton=e;c.rightNavButton=f;require("/ui/common/globals").openmodal(c);return c};
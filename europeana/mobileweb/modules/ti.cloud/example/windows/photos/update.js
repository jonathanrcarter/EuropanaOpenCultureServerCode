windowFunctions["Update Photo"]=function(k){function l(){for(var a=0;a<e.length;a++){if(!e[a].value.length){e[a].focus();return}e[a].blur()}i.hide();f&&Ti.UI.createProgressBar&&(Cloud.onsendstream=function(a){j.value=0.5*a.progress},Cloud.ondatastream=function(a){j.value=0.5*a.progress+0.5});Cloud.Photos.update({photo_id:k.id,photo:f,tags:g.value,collection_id:h},function(a){f&&(Cloud.onsendstream=Cloud.ondatastream=null);a.success?(f=null,alert("Updated!")):error(a);i.show()})}var b=createWindow(),
m=addBackButton(b),c=Ti.UI.createScrollView({top:m+u,contentHeight:"auto",layout:"vertical"});b.add(c);var f;if(Ti.Media.openPhotoGallery){var d=Ti.UI.createButton({title:"Select Photo from Gallery",top:10+u,left:10+u,right:10+u,bottom:10+u,height:40+u});d.addEventListener("click",function(){Ti.Media.openPhotoGallery({success:function(a){f=a.media}})});c.add(d)}Ti.Media.showCamera&&(d=Ti.UI.createButton({title:"Take Photo with Camera",top:10+u,left:10+u,right:10+u,bottom:10+u,height:40+u}),d.addEventListener("click",
function(){Ti.Media.showCamera({success:function(a){f=a.media}})}),c.add(d));var h,d=Ti.UI.createButton({title:"Choose Collection",top:10+u,left:10+u,right:10+u,bottom:10+u,height:40+u});d.addEventListener("click",function(){function a(a){Cloud.PhotoCollections.search({user_id:a},function(a){if(a.success)if(0==a.collections.length)b.remove(c),alert("No photo collections exist! Create one first.");else{var d=[];d.push(Ti.UI.createTableViewRow({title:"No Collection",id:"",hasCheck:!h}));(function p(a,
c){for(var b=0,o=a.length;b<o;b++)d.push(Ti.UI.createTableViewRow({title:c+a[b].name,id:a[b].id,hasCheck:h==a[b].id})),a[b].subcollections&&p(a[b].subcollections,a[b].name+":")})(a.collections,"");c.setData(d)}else b.remove(c),error(a)})}var c=Ti.UI.createTableView({backgroundColor:"#fff",data:[{title:"Loading, please wait..."}]});c.addEventListener("click",function(a){h=a.row.id;b.remove(c)});b.add(c);Cloud.Users.showMe(function(b){b.success?a(b.users[0].id):(c.setData([{title:b.error&&b.message||
b}]),error(b))})});c.add(d);var g=Ti.UI.createTextField({hintText:"Tags (csv)",top:10+u,left:10+u,right:10+u,height:40+u,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,autocapitalization:Ti.UI.TEXT_AUTOCAPITALIZATION_NONE,autocorrect:!1});c.add(g);var i=Ti.UI.createButton({title:"Update",top:10+u,left:10+u,right:10+u,bottom:10+u,height:40+u});c.add(i);if(Ti.UI.createProgressBar){var j=Ti.UI.createProgressBar({top:10+u,right:10+u,left:10+u,max:1,min:0,value:0,height:25+u});c.add(j);j.show()}var e=[g];
i.addEventListener("click",l);for(c=0;c<e.length;c++)e[c].addEventListener("return",l);var n=Ti.UI.createLabel({text:"Loading, please wait...",textAlign:"center",top:m+u,right:0,bottom:0,left:0,backgroundColor:"#fff",zIndex:2});b.add(n);b.addEventListener("open",function(){Cloud.Photos.show({photo_id:k.id},function(a){n.hide();a.success?(a=a.photos[0],a.collections&&0<a.collections.length&&(h=a.collections[0].id),g.value=a.tags&&a.tags.join(","),g.focus()):error(a)})});b.open()};
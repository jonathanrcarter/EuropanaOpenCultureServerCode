windowFunctions["Create Photo"]=function(){var e=createWindow(),d=addBackButton(e),d=Ti.UI.createScrollView({top:d+u,contentHeight:"auto",layout:"vertical"});e.add(d);if(Ti.UI.createProgressBar){var h=Ti.UI.createProgressBar({top:10+u,right:10+u,left:10+u,max:1,min:0,value:0,height:25+u});d.add(h);h.show()}var f;if(Ti.Media.openPhotoGallery){var a=Ti.UI.createButton({title:"Select Photo from Gallery",top:10+u,left:10+u,right:10+u,bottom:10+u,height:40+u});a.addEventListener("click",function(){Ti.Media.openPhotoGallery({success:function(b){f=
b.media}})});d.add(a)}Ti.Media.showCamera&&(a=Ti.UI.createButton({title:"Take Photo with Camera",top:10+u,left:10+u,right:10+u,bottom:10+u,height:40+u}),a.addEventListener("click",function(){Ti.Media.showCamera({success:function(b){f=b.media}})}),d.add(a));var g,a=Ti.UI.createButton({title:"Choose Collection",top:10+u,left:10+u,right:10+u,bottom:10+u,height:40+u});a.addEventListener("click",function(){function b(b){Cloud.PhotoCollections.search({user_id:b},function(b){if(b.success)if(0==b.collections.length)e.remove(a),
alert("No photo collections exist! Create one first.");else{var d=[];d.push(Ti.UI.createTableViewRow({title:"No Collection",id:"",hasCheck:!g}));(function i(a,b){for(var c=0,e=a.length;c<e;c++)d.push(Ti.UI.createTableViewRow({title:b+a[c].name,id:a[c].id,hasCheck:g==a[c].id})),a[c].subcollections&&i(a[c].subcollections,a[c].name+":")})(b.collections,"");a.setData(d)}else e.remove(a),error(b)})}var a=Ti.UI.createTableView({backgroundColor:"#fff",data:[{title:"Loading, please wait..."}]});a.addEventListener("click",
function(b){g=b.row.id;e.remove(a)});e.add(a);Cloud.Users.showMe(function(c){c.success?b(c.users[0].id):(a.setData([{title:c.error&&c.message||c}]),error(c))})});d.add(a);a=Ti.UI.createButton({title:"Create",top:10+u,left:10+u,right:10+u,bottom:10+u,height:40+u});a.addEventListener("click",function(){f?(Ti.UI.createProgressBar&&(Cloud.onsendstream=function(a){h.value=0.5*a.progress},Cloud.ondatastream=function(a){h.value=0.5*a.progress+0.5}),Cloud.Photos.create({photo:f,collection_id:g,"photo_sync_sizes[]":"small_240"},
function(a){Cloud.onsendstream=Cloud.ondatastream=null;a.success?(g=f=null,alert("Uploaded!")):error(a)})):alert("Please provide a photo!")});d.add(a);e.open()};
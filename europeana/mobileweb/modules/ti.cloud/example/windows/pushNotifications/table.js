Ti.include("notify.js","settings.js","subscribe.js","unsubscribe.js");windowFunctions["Push Notifications"]=function(){var a=createWindow(),b=addBackButton(a),c=["Notify"];if("iPhone OS"===Ti.Platform.name||"android"===Ti.Platform.name)c.push("Settings for This Device"),c.push("Subscribe"),c.push("Unsubscribe");b=Ti.UI.createTableView({backgroundColor:"#fff",top:b+u,data:createRows(c)});b.addEventListener("click",handleOpenWindow);a.add(b);a.open()};
function receivePush(a){alert("Received push: "+JSON.stringify(a))}var androidPushModule=null,pushDeviceToken=null,pushNotificationsEnabled=null;function enablePushNotifications(){pushNotificationsEnabled=!0;Ti.App.Properties.setBool("PushNotifications-Enabled",!0);checkPushNotifications()}function disablePushNotifications(){pushNotificationsEnabled=!1;Ti.App.Properties.setBool("PushNotifications-Enabled",!1);checkPushNotifications()}
function getAndroidPushModule(){try{return require("ti.cloudpush")}catch(a){return alert("Unable to require the ti.cloudpush module for Android!"),pushNotificationsEnabled=!1,Ti.App.Properties.setBool("PushNotifications-Enabled",!1),null}}
function checkPushNotifications(){null===pushNotificationsEnabled&&(pushNotificationsEnabled=Ti.App.Properties.getBool("PushNotifications-Enabled",!1));if("iPhone OS"===Ti.Platform.name)pushNotificationsEnabled?"Simulator"==Titanium.Platform.model?(alert("The simulator does not support push!"),disablePushNotifications()):Ti.Network.registerForPushNotifications({types:[Ti.Network.NOTIFICATION_TYPE_BADGE,Ti.Network.NOTIFICATION_TYPE_ALERT,Ti.Network.NOTIFICATION_TYPE_SOUND],success:deviceTokenSuccess,
error:deviceTokenError,callback:receivePush}):(Ti.Network.unregisterForPushNotifications(),pushDeviceToken=null);else if("android"===Ti.Platform.name){if(null===androidPushModule&&(androidPushModule=getAndroidPushModule(),null===androidPushModule))return;pushNotificationsEnabled?androidPushModule.retrieveDeviceToken({success:deviceTokenSuccess,error:deviceTokenError}):(androidPushModule.enabled=!1,androidPushModule.removeEventListener("callback",receivePush),pushDeviceToken=null)}}
function deviceTokenSuccess(a){pushDeviceToken=a.deviceToken;alert("Device token is retrieved: "+pushDeviceToken);Ti.API.info("Device Token: "+pushDeviceToken);androidPushModule.enabled=!0;androidPushModule.addEventListener("callback",receivePush)}function deviceTokenError(a){alert("Failed to register for push! "+a.error);disablePushNotifications()}checkPushNotifications();
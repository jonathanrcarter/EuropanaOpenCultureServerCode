windowFunctions["Create Checkin"]=function(){function b(a,b){Cloud.Places.search({latitude:a,longitude:b},function(a){if(a.success)if(0==a.places.length)c.setData([{title:"No Results!"}]);else{for(var b=[],d=0,e=a.places.length;d<e;d++)b.push(Ti.UI.createTableViewRow({title:a.places[d].name,id:a.places[d].id}));c.setData(b)}else error(a)})}var d=createWindow(),f=addBackButton(d),c=Ti.UI.createTableView({backgroundColor:"#fff",top:f+u,bottom:0});c.addEventListener("click",function(a){if(a.row.id){var b=
a.row.title;a.row.title="Checking in, please wait...";Cloud.Checkins.create({place_id:a.row.id},function(c){a.row.title=b;c.success?alert("Checked in to "+b+"!"):error(c)})}});d.add(c);d.addEventListener("open",function(){c.setData([{title:"Geolocating..."}]);Ti.Geolocation?(Ti.Geolocation.purpose="To find nearby places.",Ti.Geolocation.accuracy=Ti.Geolocation.ACCURACY_BEST,Ti.Geolocation.distanceFilter=0,Ti.Geolocation.getCurrentPosition(function(a){!a.success||a.error?(b(null,null),c.setData([{title:"GPS lost, looking nearby..."}])):
(c.setData([{title:"Located, looking nearby..."}]),b(a.coords.latitude,a.coords.longitude))})):Cloud.Clients.geolocate(function(a){a.success?(c.setData([{title:"Located, looking nearby..."}]),b(a.location.latitude,a.location.longitude)):(b(null,null),c.setData([{title:"GPS lost, looking nearby..."}]))})});d.open()};